var pitchSetDictFull = {
  "ps193": {
    "ob": ["F#5", "fih''", 734.8205566406249, 77.87866155272926, -66.68175506591797],
    "vl": ["G5", "g''", 793.3639526367189, 79.20575189744818, -68.43545532226562],
    "pno": ["A#3", "ais", 230.1361083984375, 57.7798060403218, -69.39955139160156],
    "perc": ["C4", "c'", 259.74426269531244, 59.87506030890799, -69.5511703491211],
    "vla": ["F4", "f'", 346.5499877929689, 64.866719326538, -68.47416687011719],
    "trb": ["E¼b4", "eeh'", 322.99804687500006, 63.648263008993254, -66.6878433227539],
    "bcl": ["A¼b3", "aeh", 213.98620605468747, 56.52017132510329, -56.3149299621582],
    "vc": ["G¼#3", "gih", 201.87377929687506, 55.5114001476416, -68.81878662109375]
  },
  "ps113": {
    "ob": ["G5", "g''", 794.0368652343749, 79.22042959268147, -64.76925659179688],
    "vln": ["C#5", "cih''", 558.5174560546874, 73.12918617650247, -63.97966766357422],
    "pno": ["A#3", "ais", 231.48193359375, 57.8807529181162, -62.436012268066406],
    "perc": ["G4", "g'", 396.34552001953136, 67.19106174765656, -58.106101989746094],
    "vla": ["D4¼#", "dih'", 298.77319335937506, 62.298566257892304, -53.915794372558594],
    "trb": ["G3¼#", "gih", 200.52795410156247, 55.395598107236964, -64.15660858154297],
    "bcl": ["A3", "a", 222.0611572265625, 57.16144243264082, -61.627532958984375],
    "vc": ["C3¼#", "cih", 133.90960693359375, 48.405071308214815, -61.66714096069336]
  },
  "ps173": {
    "ob": ["D5", "d''", 586.7797851562501, 73.98378775901415, -60.00305938720703],
    "vln": ["F5", "f''", 704.539489746094, 77.15012458486073, -64.7326889038086],
    "pno": ["G3", "g", 197.8363037109375, 55.1616439997274, -58.672576904296875],
    "perc": ["A3", "a", 218.023681640625, 56.843775896306525, -63.52577590942383],
    "vla": ["G¼b4", "geh'", 382.8872680664063, 66.59299396937001, -65.16079711914062],
    "trb": ["E4", "e'", 327.03552246093733, 63.86332590496039, -65.4526596069336],
    "bcl": ["A¼b2", "aeh", 107.666015625, 44.628713000339374, -65.81742095947266],
    "vc": ["A¼b3", "aeh", 215.33203124999997, 56.628713000339374, -65.77326965332031]

  },
  "ps44": {
    "ob": ["C¼b5", "ceh''", 513.4323120117185, 71.67204682370539, -54.20226287841797],
    "vln": ["B¼b4", "beh'", 476.7585754394528, 70.38906437670724, -56.74132537841797],
    "pno": ["A4", "a'", 438.73901367187483, 68.95031371246395, -55.0628662109375],
    "perc": ["F#4", "fis'", 364.04571533203136, 65.71939326761282, -47.91668701171875],
    "vla": ["D4", "d'", 291.37115478515614, 61.86425443841172, -55.55368423461914],
    "trb": ["A3", "a", 218.023681640625, 56.843775896306525, -54.03341293334961],
    "bcl": ["G3", "g", 196.49047851562506, 55.04347056825124, -52.384952545166016],
    "vc": ["D¼b3", "des", 144.0032958984375, 49.66317969850479, -53.01714324951172]
  },
  "ps27": {
    "ob": ["G5", "g''", 794.0368652343749, 79.22042959268147, -55.520206451416016],
    "vln": ["F1/4#4", "fih'", 355.2978515625, 65.29830529399247, -59.45197296142578],
    "pno": ["F5", "f''", 706.5582275390624, 77.19965921233285, -57.727317810058594],
    "perc": ["D5", "d''", 593.5089111328123, 74.18119400838127, -59.670982360839844],
    "vla": ["B1/4b3", "beh", 236.86523437499994, 58.27875528533859, -59.702964782714844],
    "trb": ["A1/4b3", "aeh", 213.98620605468747, 56.52017132510329, -56.72692108154297],
    "bcl": ["A1/4b2", "aeh,", 107.666015625, 44.628713000339374, -57.23842239379883],
    "vc": ["G1/4#3", "geh", 203.2196044921875, 55.626432733591976, -58.54011917114258]
  },
  "ps1": {
    "ob": ["A4", "a'", 441.4306640625, 69.05619991710803, -60.34303283691406],
    "vln": ["Bb4", "bes'", 461.6180419921875, 69.83035305576477, -60.34886169433594],
    "pn": ["G4", "g'", 396.34552001953136, 67.19106174765656, -55.7911491394043],
    "perc": ["D4", "d'", 294.06280517578114, 62.0234494956982, -52.699337005615234],
    "vla": ["D#4", "dis'", 310.88562011718756, 62.98656435868372, -60.32509231567383],
    "tb": ["G3", "g", 197.8363037109375, 55.1616439997274, -54.86480712890625],
    "bcl": ["c3", "c", 131.21795654296875, 48.05353962668636, -57.08091354370117],
    "vc": ["D3", "d", 146.69494628906256, 49.98378775901415, -59.329627990722656]
  }
};

var notesMidiDict = {
  36: '/svgs/036c2.svg',
  36.5: '/svgs/036p5cqs2.svg',
  37.0: '/svgs/037cs2.svg',
  37.5: '/svgs/037p5dqf2.svg',
  38.0: '/svgs/038d2.svg',
  38.5: '/svgs/038p5dqs2.svg',
  39.0: '/svgs/039ds2.svg',
  39.5: '/svgs/039p5eqf2.svg',
  40.0: '/svgs/040e2.svg',
  40.5: '/svgs/040p5fqf2.svg',
  41.0: '/svgs/041f2.svg',
  41.5: '/svgs/041p5fqs2.svg',
  42.0: '/svgs/042fs2.svg',
  42.5: '/svgs/042p5gqf2.svg',
  43.0: '/svgs/043g2.svg',
  43.5: '/svgs/043p5gqs2.svg',
  44.0: '/svgs/044gs2.svg',
  44.5: '/svgs/044p5aqf2.svg',
  45.0: '/svgs/045a2.svg',
  45.5: '/svgs/045p5aqs2.svg',
  46.0: '/svgs/046bf2.svg',
  46.5: '/svgs/046p5bqf2.svg',
  47.0: '/svgs/047b2.svg',
  47.5: '/svgs/047p5cqf3.svg',
  48.0: '/svgs/048c3.svg',
  48.5: '/svgs/048p5cqs3.svg',
  49.0: '/svgs/049cs3.svg',
  49.5: '/svgs/049p5dqf3.svg',
  50.0: '/svgs/050d3.svg',
  50.5: '/svgs/050p5dqs3.svg',
  51.0: '/svgs/051ef3.svg',
  51.5: '/svgs/051p5eqf3.svg',
  52.0: '/svgs/052e3.svg',
  52.5: '/svgs/052p5fqf3.svg',
  53.0: '/svgs/053f3.svg',
  53.5: '/svgs/053p5fqs3.svg',
  54.0: '/svgs/054fs3.svg',
  54.5: '/svgs/054p5gqf3.svg',
  55.0: '/svgs/055g3.svg',
  55.5: '/svgs/055p5gqs3.svg',
  56.0: '/svgs/056gs3.svg',
  56.5: '/svgs/056p5aqf3.svg',
  57.0: '/svgs/057a3.svg',
  57.5: '/svgs/057p5aqs3.svg',
  58.0: '/svgs/058bf3.svg',
  58.5: '/svgs/058p5bqf3.svg',
  59.0: '/svgs/059b3.svg',
  59.5: '/svgt/059p5cqb4t.svg',
  60.0: '/svgt/060c4t.svg',
  60.5: '/svgt/060p5cqs4t.svg',
  61.0: '/svgt/061cs4t.svg',
  61.5: '/svgs/061p5dqf4.svg',
  62.0: '/svgs/062d4.svg',
  62.5: '/svgs/062p5dqs4.svg',
  63.0: '/svgs/063ef4.svg',
  63.5: '/svgs/063p5eqf4.svg',
  64.0: '/svgs/064e4.svg',
  64.5: '/svgs/064p5fqf4.svg',
  65.0: '/svgs/065f4.svg',
  65.5: '/svgs/065p5fqs4.svg',
  66.0: '/svgs/066fs4.svg',
  66.5: '/svgs/066p5gqf4.svg',
  67.0: '/svgs/067g4.svg',
  67.5: '/svgs/067p5gqs4.svg',
  68.0: '/svgs/068gs4.svg',
  68.5: '/svgs/068p5aqf4.svg',
  69.0: '/svgs/069a4.svg',
  69.5: '/svgs/069p5aqs4.svg',
  70.0: '/svgs/070bf4.svg',
  70.5: '/svgs/070p5bqf4.svg',
  71.0: '/svgs/071b4.svg',
  71.5: '/svgs/071p5cqf5.svg',
  72.0: '/svgs/072c5.svg',
  72.5: '/svgs/072p5cqs5.svg',
  73.0: '/svgs/073cs5.svg',
  73.5: '/svgs/073p5dqf5.svg',
  74.0: '/svgs/074d5.svg',
  74.5: '/svgs/074p5dqs5.svg',
  75.0: '/svgs/075ef5.svg',
  75.5: '/svgs/075p5eqf5.svg',
  76.0: '/svgs/076e5.svg',
  76.5: '/svgs/076p5fqf5.svg',
  77.0: '/svgs/077f5.svg',
  77.5: '/svgs/077p5fqs5.svg',
  78.0: '/svgs/078fs5.svg',
  78.5: '/svgs/078p5gqf5.svg',
  79.0: '/svgs/079g5.svg',
  79.5: '/svgs/079p5gqs5.svg',
  80.0: '/svgs/080gs5.svg',
  80.5: '/svgs/080p5aqf5.svg',
  81.0: '/svgs/081a5.svg'
};

var pitchSetDictByPSByPart = {
  "ps193": [
    [77.87866155272926, '/svgs/078fs5.svg'],
    [79.20575189744818, '/svgs/079g5.svg'],
    [57.7798060403218, '/svgs/058bf3.svg'],
    [59.87506030890799, '/svgt/060c4t.svg'],
    [64.866719326538, '/svgs/065f4.svg'],
    [63.648263008993254, '/svgs/063p5eqf4.svg'],
    [56.52017132510329, '/svgs/056p5aqf3.svg'],
    [55.5114001476416, '/svgs/055p5gqs3.svg']
  ],

  "ps113": [
    [79.22042959268147, '/svgs/079g5.svg'],
    [73.12918617650247, '/svgs/073cs5.svg'],
    [57.8807529181162, '/svgs/058bf3.svg'],
    [67.19106174765656, '/svgs/067g4.svg'],
    [62.298566257892304, '/svgs/062p5dqs4.svg'],
    [55.395598107236964, '/svgs/055p5gqs3.svg'],
    [57.16144243264082, '/svgs/057a3.svg'],
    [48.405071308214815, '/svgs/048p5cqs3.svg']
  ],

  "ps173": [
    [73.98378775901415, '/svgs/074d5.svg'],
    [77.15012458486073, '/svgs/077f5.svg'],
    [55.1616439997274, '/svgs/055g3.svg'],
    [56.843775896306525, '/svgs/057a3.svg'],
    [66.59299396937001, '/svgs/066p5gqf4.svg'],
    [63.86332590496039, '/svgs/064e4.svg'],
    [44.628713000339374, '/svgs/044p5aqf2.svg'],
    [56.628713000339374, '/svgs/057a3.svg']
  ],

  "ps44": [
    [71.67204682370539, '/svgs/071p5cqf5.svg'],
    [70.38906437670724, '/svgs/070p5bqf4.svg'],
    [68.95031371246395, '/svgs/069a4.svg'],
    [65.71939326761282, '/svgs/066fs4.svg'],
    [61.86425443841172, '/svgs/062d4.svg'],
    [56.843775896306525, '/svgs/057a3.svg'],
    [55.04347056825124, '/svgs/055g3.svg'],
    [49.66317969850479, '/svgs/049p5dqf3.svg']
  ],

  "ps27": [
    [79.22042959268147, '/svgs/079g5.svg'],
    [65.29830529399247, '/svgs/065p5fqs4.svg'],
    [77.19965921233285, '/svgs/077f5.svg'],
    [74.18119400838127, '/svgs/074d5.svg'],
    [58.27875528533859, '/svgs/058p5bqf3.svg'],
    [56.52017132510329, '/svgs/056p5aqf3.svg'],
    [44.628713000339374, '/svgs/044p5aqf2.svg'],
    [55.626432733591976, '/svgs/055p5gqs3.svg']
  ],

  "ps1": [
    [69.05619991710803, '/svgs/069a4.svg'],
    [69.83035305576477, '/svgs/070bf4.svg'],
    [67.19106174765656, '/svgs/067g4.svg'],
    [62.0234494956982, '/svgs/062d4.svg'],
    [62.98656435868372, '/svgs/063ef4.svg'],
    [55.1616439997274, '/svgs/055g3.svg'],
    [48.05353962668636, '/svgs/048c3.svg'],
    [49.98378775901415, '/svgs/050d3.svg']
  ],

  "nopitch": [
    [0, '/svgs/blank.svg'],
    [0, '/svgs/blank.svg'],
    [0, '/svgs/blank.svg'],
    [0, '/svgs/blank.svg'],
    [0, '/svgs/blank.svg'],
    [0, '/svgs/blank.svg'],
    [0, '/svgs/blank.svg'],
    [0, '/svgs/blank.svg']
  ],
  "ps193alt": [
    [77.87866155272926, '/svgs/078fs5.svg'],
    [79.20575189744818, '/svgs/079g5.svg'],
    [57.7798060403218, '/svgs/piano_cres_pitches_ps193.svg'],
    [59.87506030890799, '/svgt/060c4t.svg'],
    [64.866719326538, '/svgs/065f4.svg'],
    [63.648263008993254, '/svgs/063p5eqf4.svg'],
    [56.52017132510329, '/svgs/056p5aqf3.svg'],
    [55.5114001476416, '/svgs/055p5gqs3.svg']
  ],

  "ps113alt": [
    [79.22042959268147, '/svgs/079g5.svg'],
    [73.12918617650247, '/svgs/073cs5.svg'],
    [57.8807529181162, '/svgs/piano_cres_pitches_ps113.svg'],
    [67.19106174765656, '/svgs/067g4.svg'],
    [62.298566257892304, '/svgs/062p5dqs4.svg'],
    [55.395598107236964, '/svgs/055p5gqs3.svg'],
    [57.16144243264082, '/svgs/057a3.svg'],
    [48.405071308214815, '/svgs/048p5cqs3.svg']
  ],

  "ps173alt": [
    [73.98378775901415, '/svgs/074d5.svg'],
    [77.15012458486073, '/svgs/077f5.svg'],
    [55.1616439997274, '/svgs/piano_cres_pitches_ps173.svg'],
    [56.843775896306525, '/svgs/057a3.svg'],
    [66.59299396937001, '/svgs/066p5gqf4.svg'],
    [63.86332590496039, '/svgs/064e4.svg'],
    [44.628713000339374, '/svgs/044p5aqf2.svg'],
    [56.628713000339374, '/svgs/057a3.svg']
  ],

  "ps44alt": [
    [71.67204682370539, '/svgs/071p5cqf5.svg'],
    [70.38906437670724, '/svgs/070p5bqf4.svg'],
    [68.95031371246395, '/svgs/piano_cres_pitches_ps44.svg'],
    [65.71939326761282, '/svgs/066fs4.svg'],
    [61.86425443841172, '/svgs/062d4.svg'],
    [56.843775896306525, '/svgs/057a3.svg'],
    [55.04347056825124, '/svgs/055g3.svg'],
    [49.66317969850479, '/svgs/049p5dqf3.svg']
  ],

  "ps27alt": [
    [79.22042959268147, '/svgs/079g5.svg'],
    [65.29830529399247, '/svgs/065p5fqs4.svg'],
    [77.19965921233285, '/svgs/piano_cres_pitches_ps27.svg'],
    [74.18119400838127, '/svgs/074d5.svg'],
    [58.27875528533859, '/svgs/058p5bqf3.svg'],
    [56.52017132510329, '/svgs/056p5aqf3.svg'],
    [44.628713000339374, '/svgs/044p5aqf2.svg'],
    [55.626432733591976, '/svgs/055p5gqs3.svg']
  ],

  "ps1alt": [
    [69.05619991710803, '/svgs/069a4.svg'],
    [69.83035305576477, '/svgs/070bf4.svg'],
    [67.19106174765656, '/svgs/piano_cres_pitches_ps1.svg'],
    [62.0234494956982, '/svgs/062d4.svg'],
    [62.98656435868372, '/svgs/063ef4.svg'],
    [55.1616439997274, '/svgs/055g3.svg'],
    [48.05353962668636, '/svgs/048c3.svg'],
    [49.98378775901415, '/svgs/050d3.svg']
  ]
};
// Generate Pitch Sets
var pitchSets = [];
var pitchSetsOG = ["ps1", "ps27", "ps44", "ps113", "ps173", "ps193"];
for (var i = 0; i < 21; i++) {
  var t_psScramb = shuffle(pitchSetsOG);
  for (var j = 0; j < t_psScramb.length; j++) {
    pitchSets.push(t_psScramb[j]);
  }
}
pitchSets.unshift("ps1");
//Remove direct repeats
for (var i = 1; i < pitchSets.length; i++) {
  if (pitchSets[i] == pitchSets[i - 1]) {
    pitchSets.splice(i, 1);
  }
}
var pitchSetIx = 1;
////// [0]oboe, [1]Violin,  [2]Piano, [3]Perc, [4]Viola, [5]Trombone, [6]Bass Clarinet, [7]Cello
// Dictionary of notation paths
var notationElementDictByElementByPart = {
  'pulseTrack': [
    '/elements/wygioatynlib_pulsetrack_a.svg',
    '/elements/wygioatynlib_pulsetrack_a.svg',
    '/elements/wygioatynlib_pulsetrack_a.svg',
    '/elements/wygioatynlib_pulsetrack_a.svg',
    '/elements/wygioatynlib_pulsetrack_a.svg',
    '/elements/wygioatynlib_pulsetrack_a.svg',
    '/elements/wygioatynlib_pulsetrack_a.svg',
    '/elements/wygioatynlib_pulsetrack_a.svg'
  ],
  'pulseTrackLoops': [
    '/elements/wygioatynlib_pulsetrack_b.svg',
    '/elements/wygioatynlib_pulsetrack_b.svg',
    '/elements/wygioatynlib_pulsetrack_b.svg',
    '/elements/wygioatynlib_pulsetrack_b.svg',
    '/elements/wygioatynlib_pulsetrack_b.svg',
    '/elements/wygioatynlib_pulsetrack_b.svg',
    '/elements/wygioatynlib_pulsetrack_b.svg',
    '/elements/wygioatynlib_pulsetrack_b.svg'
  ],
  'graceNoteGestures': [
    '/elements/graceNoteFigures_oboe.svg',
    '/elements/graceNoteFigures_violin.svg',
    '/elements/graceNoteFigures_piano.svg',
    '/elements/graceNoteFigures_glock.svg',
    '/elements/graceNoteFigures_viola.svg',
    '/elements/graceNoteFigures_trombone.svg',
    '/elements/graceNoteFigures_bassClarinet.svg',
    '/elements/graceNoteFigures_cello.svg'
  ],
  'blank': [
    '/svgs/blank.svg',
    '/svgs/blank.svg',
    '/svgs/blank.svg',
    '/svgs/blank.svg',
    '/svgs/blank.svg',
    '/svgs/blank.svg',
    '/svgs/blank.svg',
    '/svgs/blank.svg'
  ],
  'hairpin': [
    '/elements/hairpin.svg',
    '/elements/hairpin.svg',
    '/elements/hairpin.svg',
    '/elements/hairpin.svg',
    '/elements/hairpin.svg',
    '/elements/hairpin.svg',
    '/elements/hairpin.svg',
    '/elements/hairpin.svg'
  ],
  'trill': [
    '/elements/trill.svg',
    '/elements/trill.svg',
    '/elements/trill.svg',
    '/elements/trill.svg',
    '/elements/trill.svg',
    '/elements/trill.svg',
    '/elements/trill.svg',
    '/elements/trill.svg'
  ]

};
////////////////////////////////////////////////////////////////////////////////////
// ---------------------------------------------------------------------------------------
// ---------------------------------------------------------------------------------------
////////////////////////////////////////////////////////////////////////////////////
// [ goTime, playerNum, eventType,  eventTypeSpecifics]
// EVENT TYPES: 0-beat; 1-notation; 2-pitch; 3-stop; 4-cres;
// INITIAL EVENTS ----------------------------------------------------------------------- //
var initalEventsSet = [];
for (var i = 0; i < NUMTRACKS; i++) {
  //initial pitches
  initalEventsSet.push([0, i, 2, pitchSets[0]]);
  //initial notation
  initalEventsSet.push([0, i, 1, 'pulseTrack']);
}
var eventSet = [];
// SECTION 1 ----------------------------------------------------------------------------- //
var SECTION_1_DUR = rrand(80, 100);
//// Scramble Instrument Order
var ogInst = [0, 1, 2, 3, 4, 5, 6, 7];
var instrumentOrder = shuffle(ogInst.clone());
var t_tempi = [55, 56, 57, 58, 59, 60, 61, 62];
var t_2ndEntry = rrand(6, 9);
var t_sec2StartTimes = [0, t_2ndEntry, 0, 0, 0, 0, 0, 0];
for (var i = 2; i < instrumentOrder.length; i++) {
  var t_addTime = rrand(2, 4);
  t_sec2StartTimes[i] = t_sec2StartTimes[i - 1] + t_addTime;
}
for (var i = 0; i < instrumentOrder.length; i++) {
  var t_beatDur = 60.0 / t_tempi[i];
  //// Load Notation
  eventSet.push([t_sec2StartTimes[i], instrumentOrder[i], 1, 'pulseTrack']);
  //// count in
  for (var j = 1; j < 5; j++) {
    eventSet.push([(t_sec2StartTimes[i] - (t_beatDur * j)), instrumentOrder[i], 0, -1]);
  }
  //// beat Grid
  for (var j = 0; j < 999; j++) {
    var t_newTime = (t_beatDur * j) + t_sec2StartTimes[i];
    if (t_newTime < SECTION_1_DUR) {
      eventSet.push([t_newTime, instrumentOrder[i], 0, -1]);
    } else break;
  }
}
//// Section 1 pitch changes
var sec1PitchChange1Time = SECTION_1_DUR * rrand(0.4, 0.5);
var sec1PitchChange2Time = ((SECTION_1_DUR - sec1PitchChange1Time) * rrand(0.47, 0.54)) + sec1PitchChange1Time;
for (var i = 0; i < NUMTRACKS; i++) {
  eventSet.push([sec1PitchChange1Time, i, 2, pitchSets[pitchSetIx]]);
}
pitchSetIx++;
for (var i = 0; i < NUMTRACKS; i++) {
  eventSet.push([sec1PitchChange2Time, i, 2, pitchSets[pitchSetIx]]);
}
pitchSetIx++;
//Loops
var sec1LoopsStartTime = rrand((SECTION_1_DUR * 0.74), (SECTION_1_DUR * 0.78));
for (var i = 0; i < NUMTRACKS; i++) {
  eventSet.push([sec1LoopsStartTime, i, 1, 'pulseTrackLoops'])
}
// Add a group stop at the end of Section One
for (var i = 0; i < NUMTRACKS; i++) {
  eventSet.push([SECTION_1_DUR, i, 3, -1])
}
// SECTION 2 ----------------------------------------------------------------------------- //
//Grace Note Motives ------------------------------------------------------------
var SECTION_2_START = SECTION_1_DUR + 4;
var SECTION_2_DUR = rrand(97, 119);
var SECTIION_2_END = SECTION_2_START + SECTION_2_DUR;
//Load Notation ////////////////
for (var i = 0; i < NUMTRACKS; i++) {
  eventSet.push([SECTION_2_START, i, 1, 'graceNoteGestures'])
}
// No Pitches //////////////////
for (var i = 0; i < NUMTRACKS; i++) {
  eventSet.push([SECTION_2_START, i, 2, 'nopitch']);
}
// Staggered entries
var t_startOrder = shuffle(ogInst.clone());
var t_sec2StartTimes = [0, 0, 0, 0, 0, 0, 0, 0];
for (var i = 0; i < t_startOrder.length; i++) {
  var t_addTime = rrand(3, 7);
  t_sec2StartTimes[t_startOrder[i]] = (t_addTime * i) + SECTION_2_START;
}
// ACCEL ////////////////////
for (var i = 0; i < t_sec2StartTimes.length; i++) {
  var t_tempo = 13;
  var t_minDur = 0.4;
  var t_iBeatDur = 60.0 / t_tempo;
  var t_accelRate = rrand(1.03, 1.033);
  // var t_accelRate = 1.028;
  var t_beatDur = t_iBeatDur;
  var t_timeCode = t_sec2StartTimes[i];
  for (var j = 0; j < 999; j++) {
    if (t_timeCode < (SECTIION_2_END - t_iBeatDur)) {
      eventSet.push([t_timeCode, i, 0, -1]);
      t_tempo = t_tempo * t_accelRate;
      var t_newBeatDur = 60.0 / t_tempo
      t_beatDur = Math.max(t_minDur, t_newBeatDur);
      t_timeCode = t_timeCode + t_beatDur;
    } else break;
  }
}
// SECTION 3 ----------------------------------------------------------------------------- //
// Section 3 - Crescendos
var SECTION_3_START = SECTIION_2_END + 4;
var SECTION_3_DUR = rrand(110, 133);
var SECTIION_3_END = SECTION_3_START + SECTION_3_DUR;
//Load Notation ////////////////
for (var i = 0; i < NUMTRACKS; i++) {
  eventSet.push([SECTIION_2_END, i, 1, 'hairpin'])
}
// // Section 3 pitch changes
var sec3PitchChange1Time = SECTION_3_DUR * rrand(0.36, 0.42);
var sec3PitchChange2Time = ((SECTION_3_DUR - sec3PitchChange1Time) * rrand(0.47, 0.54)) + sec3PitchChange1Time;
sec3PitchChange1Time = sec3PitchChange1Time + SECTION_3_START;
sec3PitchChange2Time = sec3PitchChange2Time + SECTION_3_START;
for (var i = 0; i < NUMTRACKS; i++) {
  if (i == 2) {
    eventSet.push([SECTION_3_START, i, 2, pitchSets[pitchSetIx] + 'alt']);
  } else if (i == 3) {
    eventSet.push([SECTION_3_START, i, 2, 'nopitch']);
  } else {
    eventSet.push([SECTION_3_START, i, 2, pitchSets[pitchSetIx]]);
  }
}
pitchSetIx++;
for (var i = 0; i < NUMTRACKS; i++) {
  if (i == 2) {
    eventSet.push([sec3PitchChange1Time, i, 2, pitchSets[pitchSetIx] + 'alt']);
  } else if (i == 3) {
    eventSet.push([sec3PitchChange1Time, i, 2, 'nopitch']);
  } else {
    eventSet.push([sec3PitchChange1Time, i, 2, pitchSets[pitchSetIx]]);
  }
}
pitchSetIx++;
for (var i = 0; i < NUMTRACKS; i++) {
  if (i == 2) {
    eventSet.push([sec3PitchChange2Time, i, 2, pitchSets[pitchSetIx] + 'alt']);
  } else if (i == 3) {
    eventSet.push([sec3PitchChange2Time, i, 2, 'nopitch']);
  } else {
    eventSet.push([sec3PitchChange2Time, i, 2, pitchSets[pitchSetIx]]);
  }
}
pitchSetIx++;
var breath = 3;
var cresMin = 9;
var cresMax = 13;
var cresDurs = distributeOverRange(cresMin, cresMax, NUMTRACKS);
for (var i = 0; i < NUMTRACKS; i++) {
  var t_timeCode = SECTION_3_START;
  var t_dur = cresDurs[i];
  for (var j = 0; j < 999; j++) {
    if (t_timeCode < (SECTIION_3_END - cresMax + breath)) {
      eventSet.push([t_timeCode, i, 4, t_dur]);
      t_timeCode = t_timeCode + t_dur + breath;
    } else break;
  }
}
// SECTION 4 ----------------------------------------------------------------------------- //
// Section 4 - Trills
var SECTION_4_START = SECTIION_3_END + 3;
var SECTION_4_DUR = rrand(115, 135);
var SECTIION_4_END = SECTION_4_START + SECTION_4_DUR;
//Load Notation ////////////////
for (var i = 0; i < NUMTRACKS; i++) {
  eventSet.push([SECTIION_3_END, i, 1, 'trill'])
}
// Load PITCHES
for (var i = 0; i < NUMTRACKS; i++) {
  eventSet.push([SECTION_4_START, i, 2, pitchSets[pitchSetIx]]);
}
var breath = 1.7;
var t_accDurMin = 0.85;
var trillAccelDurs = cresDurs.clone();
var t_accelRateSet = [];
for (var i = 0; i < NUMTRACKS; i++) {
  var t_accelRate = rrand(0.897, 0.907);
  t_accelRateSet.push(t_accelRate);
}
// Staggered entries
var t_instOrder = shuffle(ogInst.clone());
var t_sec4StartTimes = [0, 0, 0, 0, 0, 0, 0, 0];
for (var i = 0; i < t_startOrder.length; i++) {
  var t_addTime = rrand(1.8, 2.4);
  t_sec4StartTimes[t_instOrder[i]] = (t_addTime * i) + SECTION_4_START;
}
//  shorten accel duration
for (var i = 0; i < NUMTRACKS; i++) {
  var t_plNum = t_instOrder[i];
  var t_timeCode = t_sec4StartTimes[t_plNum];
  var t_dur = trillAccelDurs[t_plNum];
  for (var j = 0; j < 999; j++) {
    if (t_timeCode < (SECTIION_4_END - t_accDurMin + breath)) {
      eventSet.push([t_timeCode, t_plNum, 4, t_dur]);
      t_dur = t_dur * t_accelRateSet[t_plNum];
      t_dur = Math.max(t_accDurMin, t_dur);
      t_timeCode = t_timeCode + t_dur + breath;
    } else break;
  }
}
// SECTION 5 ----------------------------------------------------------------------------- //
// Section 5 - Combos
var SECTION_5_START = SECTIION_4_END + 5;
var SECTION_5_DUR = rrand(105, 165);
var SECTIION_5_END = SECTION_5_START + SECTION_5_DUR;
//// Generate Sections
var sec5Form = palindromeTimeContainers(SECTION_5_DUR, 3, 11, 0.011, 0.20);
var sec5EvtAr = [];
for (var i = 1; i < sec5Form.length; i++) {
  var t_arr = [];
  var t_dur = sec5Form[i] - sec5Form[i - 1];
  t_arr.push(sec5Form[i - 1] + SECTION_5_START);
  t_arr.push(t_dur);
  sec5EvtAr.push(t_arr);
}
//sec5EvtAr [gotime, dur]
//generate separate event per gotime for each instrument/eventtype
var sec5EventList = [];
//Generate Large Instrument list
var sec5Insts = [];
for (var i = 0; i < 99; i++) {
  var t_insts = shuffle(ogInst.clone());
  for (var j = 0; j < t_insts.length; j++) {
    sec5Insts.push(t_insts[j]);
  }
}
for (var i = 0; i < sec5EvtAr.length; i++) {
  var t_numInstsThisSection = rrandInt(2, 4);
  t_instsAr = [];
  //This rediculous, convoluted bit of code makes sure
  //there are no duplicate instruments and each
  //instrument gets equal playing time
  for (var j = 0; j < t_numInstsThisSection; j++) {
    if (j == 0) {
      t_instsAr.push(sec5Insts[0]);
      sec5Insts.splice(0, 1);

    } else {
      for (var k = 0; k < 99; k++) {
        var t_inst = sec5Insts[k];
        var t_dups = false;
        for (var l = 0; l < t_instsAr.length; l++) {
          if (t_instsAr[l] == t_inst) {
            t_dups = true;
          }
        }
        if (t_dups == false) {
          t_instsAr.push(t_inst);
          sec5Insts.splice(k, 1);
          break;
        }
      }
    }
  }
  //clone timecode and add instrument add event
  for (var j = 0; j < t_numInstsThisSection; j++) {
    var t_evar = sec5EvtAr[i].clone();
    //add instrument
    t_evar.push(t_instsAr[j]);
    var t_randEvt = rrandInt(0, 4);
    t_evar.push(t_randEvt);
    sec5EventList.push(t_evar);
  }
}
//remove Pitches and notation for each section
for (var i = 0; i < sec5EvtAr.length; i++) {
  var t_tc = sec5EvtAr[i][0];
  for (var j = 0; j < NUMTRACKS; j++) {
    //remove pitches
    eventSet.push([t_tc - 0.01, j, 2, 'nopitch']);
    //remove notation
    eventSet.push([t_tc - 0.01, j, 1, 'blank']);
  }
}
//Add new events
for (var i = 0; i < sec5EventList.length; i++) {
  var t_tc = sec5EventList[i][0];
  var t_dur = sec5EventList[i][1];
  var t_instNum = sec5EventList[i][2];
  var t_eventTp = sec5EventList[i][3];
  switch (t_eventTp) {
    case 0: //cres
      //add pitches
      eventSet.push([t_tc, t_instNum, 2, pitchSets[pitchSetIx]]);
      //Load Notation ////////////////
      eventSet.push([t_tc, t_instNum, 1, 'hairpin'])
      //make event
      eventSet.push([t_tc, t_instNum, 4, t_dur]);
      break;
    case 1: //Trill
      //add pitches
      eventSet.push([t_tc, t_instNum, 2, pitchSets[pitchSetIx]]);
      //Load Notation ////////////////
      eventSet.push([t_tc, t_instNum, 1, 'trill'])
      //make event
      eventSet.push([t_tc, t_instNum, 4, t_dur]);
      break;
    case 2: //Grace Note Accel
      //Load Notation ////////////////
      eventSet.push([t_tc, t_instNum, 1, 'graceNoteGestures'])
      var t_minDur = 0.5;
      var t_iBeatDur = t_dur / 4;
      var t_accelRate = rrand(0.79, 0.87);
      var t_beatDur = t_iBeatDur;
      var t_timeCode = t_tc;
      var t_tcNext = t_tc + t_dur;
      for (var j = 0; j < 999; j++) {
        if (t_timeCode < t_tcNext) {
          eventSet.push([t_timeCode, t_instNum, 0, -1]);
          var t_newBeatDur = t_beatDur * t_accelRate;
          t_beatDur = Math.max(t_minDur, t_newBeatDur);
          t_timeCode = t_timeCode + t_beatDur;
        } else break;
      }
      break;
    case 3: // Accel
      //add pitches
      eventSet.push([t_tc, t_instNum, 2, pitchSets[pitchSetIx]]);
      var t_minDur = 0.4;
      var t_iBeatDur = t_dur / 4;
      var t_accelRate = rrand(0.77, 0.84);
      var t_beatDur = t_iBeatDur;
      var t_timeCode = t_tc;
      var t_tcNext = t_tc + t_dur;
      for (var j = 0; j < 999; j++) {
        if (t_timeCode < t_tcNext) {
          eventSet.push([t_timeCode, t_instNum, 0, -1]);
          var t_newBeatDur = t_beatDur * t_accelRate;
          t_beatDur = Math.max(t_minDur, t_newBeatDur);
          t_timeCode = t_timeCode + t_beatDur;
        } else break;
      }
      break;
    case 4: // At Tempo
      //add pitches
      eventSet.push([t_tc, t_instNum, 2, pitchSets[pitchSetIx]]);
      var t_tempo = rrand(58, 74);
      var t_beatDur = t_tempo / 60;
      var t_tcNext = t_tc + t_dur;
      for (var j = 0; j < 999; j++) {
        var t_newTime = (t_beatDur * j) + t_tc;
        if (t_newTime < t_tcNext) {
          eventSet.push([t_newTime, t_instNum, 0, -1]);
        } else break;
      }
      break;
  }
  pitchSetIx++;
}
// SECTION 6 ----------------------------------------------------------------------------- //
//Decel ------------------------------------------------------------
var SECTION_6_START = SECTIION_5_END + 4;
var SECTION_6_DUR = rrand(70, 88);
var SECTIION_6_END = SECTION_6_START + SECTION_6_DUR;
//load pitches & notation
for (var i = 0; i < NUMTRACKS; i++) {
  eventSet.push([SECTION_6_START, i, 2, pitchSets[pitchSetIx]]);
  eventSet.push([SECTION_6_START, i, 1, 'blank']);
}
// Staggered entries
var t_startOrder = shuffle(ogInst.clone());
var t_sec6StartTimes = [0, 0, 0, 0, 0, 0, 0, 0];
for (var i = 0; i < t_startOrder.length; i++) {
  var t_addTime = rrand(3, 3.7);
  t_sec6StartTimes[t_startOrder[i]] = (t_addTime * i) + SECTION_6_START;
}
// Decels
for (var i = 0; i < NUMTRACKS; i++) {
  var t_instNum = t_startOrder[i];
  var t_iBeatDur = rrand(0.28, 0.47);
  var t_decelRate = rrand(1.03, 1.07);
  var t_beatDur = t_iBeatDur;
  var t_timeCode = t_sec6StartTimes[t_instNum];
  for (var j = 0; j < 999; j++) {
    if (t_timeCode < SECTIION_6_END) {
      eventSet.push([t_timeCode, t_instNum, 0, -1]);
      t_beatDur = t_beatDur * t_decelRate;
      t_timeCode = t_timeCode + t_beatDur;
    } else break;
  }
}
// EVENT TYPES: 0-beat; 1-notation; 2-pitch; 3-stop; 4-cres;
eventSet.sort(sortFunction2DArray);
console.log(eventSet);
// DOWNLOAD eventSet ------------------------------------------------------------ //
//Make eventSet into parseable string
// var t_str1 = "";
// for (var i = 0; i < eventSet.length; i++) {
//   var t_str = "";
//   for (var j = 0; j < eventSet[i].length; j++) {
//     var t_itStr = eventSet[i][j].toString();
//     if(j==0){
//       t_str = t_itStr;
//     } else{
//       t_str = t_str + "," + t_itStr;
//     }
//   }
//   if(i==0){
//     t_str1 = t_str;
//   } else{
//     t_str1 = t_str1 + ";" + t_str;
//   }
// }
// var timestamp = curYear + "_" + pad(monthNum, 2) + "_" + pad(dayNum, 2) + "_" +  pad(curHour, 2) + "_" + pad(curMinute, 2);
// downloadStrToHD(t_str1, timestamp + "_" + "wygioatynlib_eventSet.txt", 'text/plain');

// var eventSet = [];
// loadEvents("/eventSets/2020_01_02_07_57_wygioatynlib_eventSet.txt");

// FUNCTION: loadEvents ------------------------------------------------------------- //
function loadEvents(path) {
  fetch(path)
    .then(response => response.text())
    .then(text => {
      var t1 = text.split(";");
      var t_newArr1 = [];
      for (var i = 0; i < t1.length; i++) {
        var temparr = t1[i].split(',');
        for (var j = 0; j < temparr.length; j++) {
          if (j == 0) {
            temparr[j] = parseFloat(temparr[j]);
          }
          if (j == 1 || j == 2) {
            temparr[j] = parseInt(temparr[j]);
          }
        }
        eventSet.push(temparr);

      }
    });
}








//
